<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
    <title>Integração MOVIEdb</title>
  </head>
  <body>
    <header>
      <nav>
        <h3>MaiFilmes - MovieDB API</h3>
        <ul>
          <li><a href="/index.html">Home Page</a></li>
          <li><a href="/">Pesquisar</a></li>
        </ul>
      </nav>
    </header>

    <div class="container">
      <div class="row">
        <div class="col-12 searchbar">
          <input id="searchInput" type="text" placeholder="Digite sua busca" />
          <button  class="btn btn-primary" onclick="fetchSearchMovies()">Pesquisar</button>
        </div>
      </div>
    </div>

    <div class="container">
      <div id="bodybox" class="row">
        <h1>Pesquise seu filme favorito. . .</h1>
      </div>
    </div>

    <script>
      const myKey = "d4f2f6d06e0c6ef4374c305f6d99782e";

      async function fetchSearchMovies() {
        const queryStr = document.getElementById("searchInput").value;
        const query = queryStr.replace(/\s/g, "+");
        console.log(query);

        const res = await fetch(
          `https://api.themoviedb.org/3/search/movie?api_key=${myKey}&query=${query}&language=pt-BR`
        );
        const data = await res.json();
        const movieData = data.results;

        var output = "";

        for (var i in movieData) {
          if (movieData[i].poster_path === null || movieData[i].overview ==='' ) {
            output += "";
          } else {
            output += `
            
        <div class="col-lg-4 col-sm-12 col-md-6">
            <div class="moviecard"  onclick="window.open('https://www.themoviedb.org/movie/${movieData[i].id}', '_blank')">
            <img src="http://image.tmdb.org/t/p/w500/${movieData[i].poster_path}">
            <p class="titulo">${movieData[i].title}</p>
            <p class="sinopse">${movieData[i].overview.length > 280 ? movieData[i].overview.slice(0,280) + '. . .' : movieData[i].overview  }</p>
            <span class="data">Estreia:  ${movieData[i].release_date}</span>
            </div>
           
        </div> 
     `;
          }
        }

        document.getElementById("bodybox").innerHTML = output;
        //   console.log(output)
      }
    </script>
  </body>
</html>
